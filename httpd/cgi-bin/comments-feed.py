#!/usr/bin/python

fmt_empty = """<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href="http://www.blogger.com/styles/atom.css" type="text/css"?><feed xmlns='http://www.w3.org/2005/Atom' xmlns:openSearch='http://a9.com/-/spec/opensearchrss/1.0/'><id>tag:blogger.com,1999:blog-4737511387530797770.comments</id><updated>2008-11-08T12:43:31.582-08:00</updated><title type='text'>Widget Testing</title><link rel='http://schemas.google.com/g/2005#feed' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/comments/summary'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/comments/summary?start-index=4501&amp;max-results=500'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/'/><link rel='previous' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/comments/summary?start-index=4001&amp;max-results=500'/><author><name>neha</name><uri>http://www.blogger.com/profile/04776143720908795307</uri><email>narula@gmail.com</email></author><generator version='7.00' uri='http://www.blogger.com'>Blogger</generator><openSearch:totalResults>%d</openSearch:totalResults><openSearch:startIndex>%d</openSearch:startIndex><openSearch:itemsPerPage>%d</openSearch:itemsPerPage></feed>"""

fmt_full = """<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href="http://www.blogger.com/styles/atom.css" type="text/css"?><feed xmlns='http://www.w3.org/2005/Atom' xmlns:openSearch='http://a9.com/-/spec/opensearchrss/1.0/'><id>tag:blogger.com,1999:blog-4737511387530797770.comments</id><updated>2008-11-08T12:43:31.582-08:00</updated><title type='text'>Widget Testing</title><link rel='http://schemas.google.com/g/2005#feed' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/comments/summary'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/comments/summary?max-results=500'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/'/><author><name>neha</name><uri>http://www.blogger.com/profile/04776143720908795307</uri><email>narula@gmail.com</email></author><generator version='7.00' uri='http://www.blogger.com'>Blogger</generator><openSearch:totalResults>4</openSearch:totalResults><openSearch:startIndex>1</openSearch:startIndex><openSearch:itemsPerPage>500</openSearch:itemsPerPage><entry><id>tag:blogger.com,1999:blog-4737511387530797770.post-958652149751218323</id><published>2008-11-08T12:43:00.000-08:00</published><updated>2008-11-08T12:43:00.000-08:00</updated><app:edited xmlns:app='http://purl.org/atom/app#'>2008-11-08T12:43:00.000-08:00</app:edited><title type='text'>Is this blog specially for the widget ???</title><summary type='text'>Is this blog specially for the widget ???</summary><link rel='edit' type='application/atom+xml' href='http://www.blogger.com/feeds/4737511387530797770/2959306605251169704/comments/default/958652149751218323?v=2'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/2959306605251169704/comments/default/958652149751218323'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html?showComment=1226176980000#c958652149751218323' title=''/><author><name>P Murlidhar</name><uri>http://www.blogger.com/profile/12345775061015293208</uri><email>noreply@blogger.com</email></author><thr:in-reply-to xmlns:thr='http://purl.org/syndication/thread/1.0' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html' ref='tag:blogger.com,1999:blog-4737511387530797770.post-2959306605251169704' source='http://nehawidgets.blogspot.com/feeds/posts/default/2959306605251169704' type='text/html'/></entry><entry><id>tag:blogger.com,1999:blog-4737511387530797770.post-9083631519413969432</id><published>2008-10-27T16:46:00.000-07:00</published><updated>2008-10-27T16:46:00.000-07:00</updated><app:edited xmlns:app='http://purl.org/atom/app#'>2008-10-27T16:46:00.000-07:00</app:edited><title type='text'>This is a comment on Post 2</title><summary type='text'>This is a comment on Post 2</summary><link rel='edit' type='application/atom+xml' href='http://www.blogger.com/feeds/4737511387530797770/4630658940356112207/comments/default/9083631519413969432?v=2'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/4630658940356112207/comments/default/9083631519413969432'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/2008/10/widgets-are-working.html?showComment=1225151160000#c9083631519413969432' title=''/><author><name>neha</name><uri>http://www.blogger.com/profile/04776143720908795307</uri><email>noreply@blogger.com</email></author><thr:in-reply-to xmlns:thr='http://purl.org/syndication/thread/1.0' href='http://nehawidgets.blogspot.com/2008/10/widgets-are-working.html' ref='tag:blogger.com,1999:blog-4737511387530797770.post-4630658940356112207' source='http://nehawidgets.blogspot.com/feeds/posts/default/4630658940356112207' type='text/html'/></entry><entry><id>tag:blogger.com,1999:blog-4737511387530797770.post-11113230395159179</id><published>2008-10-27T16:45:00.001-07:00</published><updated>2008-10-27T16:45:00.001-07:00</updated><app:edited xmlns:app='http://purl.org/atom/app#'>2008-10-27T16:45:00.001-07:00</app:edited><title type='text'>This is another comment on Post 3</title><summary type='text'>This is another comment on Post 3</summary><link rel='edit' type='application/atom+xml' href='http://www.blogger.com/feeds/4737511387530797770/2959306605251169704/comments/default/11113230395159179?v=2'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/2959306605251169704/comments/default/11113230395159179'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html?showComment=1225151100001#c11113230395159179' title=''/><author><name>neha</name><uri>http://www.blogger.com/profile/04776143720908795307</uri><email>noreply@blogger.com</email></author><thr:in-reply-to xmlns:thr='http://purl.org/syndication/thread/1.0' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html' ref='tag:blogger.com,1999:blog-4737511387530797770.post-2959306605251169704' source='http://nehawidgets.blogspot.com/feeds/posts/default/2959306605251169704' type='text/html'/></entry><entry><id>tag:blogger.com,1999:blog-4737511387530797770.post-8302408631404074036</id><published>2008-10-27T16:45:00.000-07:00</published><updated>2008-10-27T16:45:00.000-07:00</updated><app:edited xmlns:app='http://purl.org/atom/app#'>2008-10-27T16:45:00.000-07:00</app:edited><title type='text'>This is a comment on Post 3</title><summary type='text'>This is a comment on Post 3</summary><link rel='edit' type='application/atom+xml' href='http://www.blogger.com/feeds/4737511387530797770/2959306605251169704/comments/default/8302408631404074036?v=2'/><link rel='self' type='application/atom+xml' href='http://nehawidgets.blogspot.com/feeds/2959306605251169704/comments/default/8302408631404074036'/><link rel='alternate' type='text/html' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html?showComment=1225151100000#c8302408631404074036' title=''/><author><name>neha</name><uri>http://www.blogger.com/profile/04776143720908795307</uri><email>noreply@blogger.com</email></author><thr:in-reply-to xmlns:thr='http://purl.org/syndication/thread/1.0' href='http://nehawidgets.blogspot.com/2008/10/json-feeds.html' ref='tag:blogger.com,1999:blog-4737511387530797770.post-2959306605251169704' source='http://nehawidgets.blogspot.com/feeds/posts/default/2959306605251169704' type='text/html'/></entry></feed>"""

# URL looks like this: /feeds/comments/summary?start-index=1001&max-results=500
#
# This is a hack to spit out comments feeds, but only to yahoo.
# We're declassifying the comments to yahoo.
#
import cgi, sys, os, socket

# Check client host name before sending comment feeds.
client = os.environ["REMOTE_ADDR"]
if not socket.gethostbyaddr(client)[0].endswith("yahoo.com"):
    sys.exit (1)


form = cgi.FieldStorage ()
_start = 1
_max = 500
_total = 4

if (form.has_key ("start-index")):
    _start = int (form["start-index"].value)
if (form.has_key ("max-results")):
    _max = int (form["max-results"].value)

sys.stdout.write ("Content-type: text/xml\r\n\r\n")
if _start == 1:
    sys.stdout.write (fmt_full)
else:
    sys.stdout.write (fmt_empty % (_total, _start, _max))
    
